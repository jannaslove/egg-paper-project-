---
title: "egg project"
author: "Janna M"
date: "8/23/2021"
output: html_document
---
This paper examines the connection between egg mass and avian flight. Past studies have found a link between reproductive strategies in Extant non-avian theropod dinosaurs.There have been differences found in the eggshell mass proportions of crown birds and dinosaurs. The differences may be linked to flight but denser sampling was needed . This paper fills that gap by examining the egg shell thickness of  114 dinosaurs and birds and comparing those differences to flight and other life history correlations . In my data replication i will be generating a phylogenetic tree, by reading in a nexus file and using the plot tree function. I will also be performing a path analysis to assess wheater bird eggs abnd replile eggs are closvly related by usings the Wilcoxon signed-rank test to get the P-value . I perfromed a path analysis to describe the relationship between body mass and Egg mass and body mass and eggshell thickness. 
### Loading packages
- I began by downloading all of the library that the author used . I was unable to download the library"(ggtree)".


```{r, warning = F}
library(nlme)
library(ape)
library(ggplot2)
library(phytools)
library(RColorBrewer)
library(plyr)
library(dplyr)
library(evobiR)
library(AICcmodavg)
library(RRphylo)
library(car)
library(hrbrthemes)
library(phylopath)
library(caper)
library(emmeans)
library(GGally)
```
I download a more recent version of R then Ran the following code to try to download ggtree
```{r}
if(!requireNamespace("BioManager",quietly=TRUE))
install.packages("BioManager")
BioManager::install("ggtree")
```
However I could not download the package BioManager, but i think ggplot was installed because i was able to use it to plot later . 

Next, i tried to plot the tree. I've done this before in my own research , but at first it would not run. I re-imported the data set.

```{r}

# Load tree 
library(readr)
treewholenew_trees <- read_csv("~/egg project/dinosaureggshellproject-main/treewholenew.trees.nex")
View(treewholenew_trees)
show_col_types = FALSE
```
```{r}
# Read tree using Nexus file 
library(ape)
library(phytools)
library(tidyverse)

#tree and data
tree<-read.nexus("~/egg project/dinosaureggshellproject-main/treewholenew.trees.nex")
```
Next I plotted the tree  and i  imported the datasets into the environment 

```{r}
#Plot Tree 
plotTree(tree)

```

I read in the table 

```{r}

data<-read.table("Datawhole.txt", header=T, stringsAsFactors=T)

mydata<-subset(data, !is.na(Egg_mass))


```
Next i assign the data egg mass equation as egg mass. 
EggMass$Mreptile- is the egg of a non-avian reptile,using the equation of Deeming and Ferguson, 1990. 
EggMass$Mbird- is the estimated egg mass of a bird , using the equation of Hoyt, 1979.

Delta is the change in the values .

The two equations are similar, but the allometric exponent for 
for birds: M = 0.00056 * L * W^2
and for non-avian reptiles the allometic exponent is : M = 0.000548 * L * W^2

```{r}
#Load and assign egg mass 
EggMass<-Data_Eggmass_equations

# Find the change in value or delta 
delta<-log(EggMass$Mreptile) - log(EggMass$Mbird)
show(delta)

# Wilcoxon signed-rank test to get the P-value 
wilcox.test(log(EggMass$Mreptile), log(EggMass$Mbird), paired=T)
#Find out what Mbird is 
# test for body mass vs egg mass
wilcox.test(log(EggMass), log(mydata), paired=T)
```
The results show that the reptile  and bird eggs  have a high correlation and are statically significant based on the P values.

The Equations are so similar that using one or the other does not influence the result and the delta value shows this.

This path analysis is describing the relationship between body mass and Egg mass and body mass and eggshell thickness. 

```{r}
#Path Analysis
```

Regression (paper)602
```{r}
datadino<-data%>%filter(Clade=="Neognaths"|Clade=="Non-avian_dinosaurs"|Clade=="Paleognaths"|Clade== "Enantiornithes"|Clade=="Ornithuromorphs")
regressL<- lm(Eggshell_thickness~Egg_mass,data = datadino)
summary(regressL)
```

Regression (my own )

```{r}
regress1<- lm(Egg_mass+Eggshell_thickness~Body_mass,data = data)
summary(regress1)
```
 Egg mass and eggshell thickness are highly correlated based on the R-Squared value. 
For every one gram of egg mass there is a 28.216 unit increase .For ever micrometer of eggshell thickness there is a 27.546 unit increase 



Data Visualization  
I used ggplot for this graph that represents Ln of  egg mass vs Ln of eggshell thickness. I was under the impression it did not load but it did .

Read in table for equations 
```{r}
EggMass<-read.table ("Data_Eggmass_equations.txt", header=TRUE)
```
Plot eggmass vs eggshell thickness

```{r}

ggplot(EggMass, aes(log(Mreptile), log(Eggshell_thickness), color=Group)) +
  geom_point(size=5) +
  xlab("ln egg mass (g)") +
  ylab("ln eggshell thickness (µm)") +
  scale_colour_brewer("group", palette="Set2")
```


Plot body mass vs egg mass 

I used ggplot again to plot body mass vs egg mass.
At first the graph looked weird because many of the data was missing body mass.


Egg mass was missing from many species i used  code to remove missing data for body mass then i re-ran the code and i got a graph similar to that of the author 
```{r}
datamass<-subset(data, !is.na(data$Body_mass))

```

```{r}
ggplot(datamass, aes(log(Egg_mass), log(Body_mass), color=Clade)) + geom_point(size=2) +
  xlab("Egg mass (g)") +
  ylab("Body mass  (µm)") +
  scale_colour_brewer("group", palette="Set2")

```
correlation 9n matrix
# Check correlations (as scatterplots), distribution and print corrleation coefficient 
```{r}
# ggpairs(Datawhole,) title="correlogram with ggpairs()") 
ggcorr(datamass, method = c("pairwise", "pearson"),
  cor_matrix = NULL,
  nbreaks = NULL,
  digits = 2,
  name = "",
  low = "#3B9AB2",
  mid = "#EEEEEE",
  high = "#F21A00",
  midpoint = 0,
  palette = NULL,
  geom = "tile",
  min_size = 2,
  max_size = 6,
  label = FALSE,
  label_alpha = FALSE,
  label_color = "black",
  label_round = 1,
  label_size = 4,
  limits = c(-1, 1),
  drop = is.null(limits) || identical(limits, FALSE),
  layout.exp = 0,
  legend.position = "right",
  legend.size = 9,
) 
Data1<-datamass[1,3,4,5]
Datadf<-data.frame(Data1)
ggpairs(Datadf, columns = 1:5, ggplot2::aes(colour=Clade))
```


```{r}
ggplot(datadino, aes(log(Egg_mass), log(Eggshell_thickness), color=Flight)) + geom_point(size=2) +
  xlab("Egg mass (g)") +
  ylab("Body mass  (µm)") +
  scale_colour_brewer("group", palette="Set2") 
  

```
```

